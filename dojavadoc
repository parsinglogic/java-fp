#!/bin/zsh

if [ -d javadocs/dev/doc-files ]; then
   chmod a+w  javadocs/dev/doc-files
fi


# remove the output dir
rm -rf javadocs

# run javadoc
#javadoc -quiet -public -sourcepath source/main/java -d javadocs  -subpackages dev  -classpath ../local-repo/io/mola/galimatias/galimatias/0.2.0/galimatias-0.2.0.jar -Xdoclint:none
javadoc -public -sourcepath source/main/java -d javadocs  -subpackages dev  -classpath ../local-repo/io/mola/galimatias/galimatias/0.2.0/galimatias-0.2.0.jar -Xdoclint:none

# remove the timestamp comment
rg --files -g '*.html' javadocs | xargs -L 1 -I f sed -i '' -e '/<!-- Generated by javadoc/d' f

# The meta dc.created thing changes every day. I'm not sure if I can delete it
#rg --files -g '*.html' javadocs | xargs -L 1 -I f sed -i '' -e '/<meta name="dc.created" content=/s/content=".*/content="2023-07-29">/' f
rg --files -g '*.html' javadocs | xargs -L 1 -I f sed -i '' -e '/<meta name="dc.created" content=/d' f


# Copy the better stylesheet into javadocs
cp stylesheet.css javadocs


echo 'use source/main/java/dev/doc-files instead' > javadocs/dev/doc-files/DONT-PUT-FILES-HERE-THESE-ARE-GENERATED 

chmod a-w  javadocs/dev/doc-files
